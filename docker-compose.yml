version: '3.3'
services:

    # btc is an image of bitcoin node which used as base image for btcd and
    # btccli. The environment variables default values determined on stage of
    # container start within starting script.
    bitcoind_service:
        image: bitcoind_image
        build:
            context: bitcoind/
        container_name: bitcoind_container
        volumes:
            - type: volume
              source: bitcoind_volume
              target: /root/bitcoin
              volume:
                nocopy: true
        environment:
            - BITCOIN_CONFIG=${BITCOIN_CONFIG}
        restart: always
        entrypoint: ["./start-bitcoind.sh"]

    lnd_service:
        image: lnd_image
        build:
            context: lnd/
        container_name: lnd_container
        volumes:
          - lnd_volume:/root/lnd
        depends_on:
            - bitcoind_service
        environment:
            - LND_CONFIG=${LND_CONFIG}
        restart: always
        entrypoint: ["./start-lnd.sh"]

volumes:
  # bitcoin volume is needed for maintaining blockchain persistence
  # during bitcoind container recreation.
  bitcoind_volume:
    driver: local

  # lnd volume is needed for maintaining lightningnetwork persistence
  # during container recreation.
  lnd_volume:
    driver: local
